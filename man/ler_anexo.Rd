% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ler_anexo.R
\name{ler_anexo}
\alias{ler_anexo}
\title{Ler anexos do arquivo excel obtido por meio da função \code{download_tarifas}.}
\usage{
ler_anexo(x, n_anexo = c("i", "ii", "iv", "v", "vi", "viii", "ix", "x"))
}
\arguments{
\item{x}{Objeto retornado por \code{download_tarifas}, que no caso é o caminho
temporário do arquivo de tarifas de importação vigentes baixado.}

\item{n_anexo}{String indicando qual anexo deve ser lido. Deve ser
um dos:
\code{"i"}, \code{"ii"}, \code{"iv"}, \code{"v"},
\code{"vi"}, \code{"viii"}, \code{"ix"}, \code{"x"}.}
}
\value{
Para \code{n_anexo = "i"}, retorna o tibble produzido por \code{ler_anexo1}.

Para os demais anexos, retorna um tibble com, no mínimo, as colunas:
\describe{
\item{ncm}{Código NCM, como texto.}
\item{no_ex}{Número do \emph{ex} padronizado com 3 dígitos}
\item{inicio_de_vigencia}{Data de início de vigência em formato
padronizado, conforme \code{formata_datas}.}
\item{termino_de_vigencia}{Data de término de vigência em formato
padronizado; quando ausente no arquivo, é preenchida com
\code{"9999-12-31"}.}
\item{data_do_ato_de_inclusao}{(Quando existente) data do ato de inclusão,
também formatada por \code{formata_datas}.}
\item{lista}{(Essa coluna vai existir se o código estiver nas seguintes
listas de exceção: Desabastecimento, Letec, Lebitbk, Concessões da OMC,
DCC ou Automotivos ACE-14.)}
}
Outras colunas presentes no anexo original são mantidas, podendo variar
conforme o tipo de anexo.
}
\description{
Lê o anexo desejado do arquivo de tarifas obtido por meio da função
\code{download_tarifas}. Para cada anexo, a função \code{ler_anexo} limpa
e organiza os dados de cada aba do arquivo (anexo).
}
\details{
Para o Anexo I, a função \code{download_tarifas} apenas delega o processamento para
a função \code{ler_anexo1}. Para os demais anexos suportados, a função:
\itemize{
\item identifica a aba correta com base no nome do anexo;
\item pula linhas de cabeçalho conforme o tipo de anexo;
\item padroniza nomes de colunas com \code{janitor::clean_names} e a partir de outras regras;
\item garante a existência de colunas de início e término de vigência;
\item formata datas com a função auxiliar \code{formata_datas};
\item padroniza códigos \code{ncm} e \code{no_ex}
}

A seleção da aba é feita com base nos nomes das planilhas do arquivo Excel,
convertidos para minúsculas, procurando um padrão que contenha o número
romano do anexo (por exemplo, \code{" iv "} para o Anexo IV).

Para o Anexo VI, caso exista uma coluna \code{x10}, ela é removida
automaticamente antes do processamento.

Quando não há coluna de término de vigência no anexo, a função cria
a coluna \code{termino_de_vigencia} com valor padrão \code{"-"} e,
em seguida, aplica \code{\link[=formata_datas]{formata_datas()}} com o argumento
\code{preenche_data = "9999-12-31"}.
}
\section{Anexos suportados}{

\itemize{
\item \code{"i"}: TEC vigente
\item \code{"ii"}: lê a aba do Anexo II
\item \code{"iv"}: lê o Anexo IV – Desabastecimento.
\item \code{"v"}: lê o Anexo V – Letec.
\item \code{"vi"}: lê o Anexo VI – Lebitbk.
\item \code{"viii"}: lê o Anexo VIII – Concessões OMC.
\item \code{"ix"}: lê o Anexo IX – DCC.
\item \code{"x"}: lê o Anexo X – Automotivo.
}
}

\examples{
\dontrun{
x <- download_tarifas()

# Ler Anexo I
anexo_i <- ler_anexo(x, n_anexo = "i")

# Ler Anexo V (Letec) já com datas e NCM padronizados
anexo_v <- ler_anexo(x, n_anexo = "v")
}

}
\seealso{
\code{download_tarifas} para obtenção do arquivo de tarifas,
\code{ler_anexo1} para o processamento específico do Anexo I
e \code{formata_datas} para limpeza e padronização de datas.
}
