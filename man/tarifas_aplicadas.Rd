% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tarifas_aplicadas.R
\name{tarifas_aplicadas}
\alias{tarifas_aplicadas}
\title{Processa os anexos tarifários e a partir deles gera uma tabela contendo
as tarifas aplicadas}
\usage{
tarifas_aplicadas(x, detalhar = FALSE)
}
\arguments{
\item{x}{Objeto, é o resultado obtido a partir da função \code{download_tarifas()}}

\item{detalhar}{Lógico, indica se o resultado deve incluir as colunas
detalhadas das listas de exceção. O padrão é \code{FALSE}. Se \code{TRUE},
retorna indicadores de contagem, de quota, de destaque (Ex) e de NCM integral.}
}
\value{
Um \code{tibble} (ou \code{data.frame}) com, no mínimo, as colunas:
\itemize{
\item \code{ncm}: código NCM;
\item \code{descricao_tec}: descrição da NCM (descrição no nível de oito dígitos)
\item \code{descricao_tec_concatenada}: descrição da NCM a partir da posição;
\item \code{bkbit}: indica se a NCM é grafada como bem de capital/bem de informática
\item \code{lista}: lista de exceção associada a uma NCM (quando aplicável);
\item \code{teb}: alíquota TEB aplicável;
\item \code{tarifa_aplicada}: A tarifa aplicada é o que consta na TEB, mas se estiver
integralmente em uma lista de exceção, a tarifa aplicada será a que consta
na lista de exceção.
}

Quando \code{detalhar = TRUE}, o retorno inclui também:
\itemize{
\item \code{contagem_quota}, \code{contagem_ex}, \code{quota}, \code{destaque_ex}, \code{ncm_integral},
conforme descrito em \code{\link[=detalhar_listas_excecao_vigentes]{detalhar_listas_excecao_vigentes()}}.
}
}
\description{
Combina as informações dos anexos I, II, IV, V, VI, VIII, IX, X para calcular
a \emph{tarifa aplicada} por código NCM. Opcionalmente,
pode retornar um resultado detalhado com indicadores de quota, destaque (Ex)
e presença da integralidade da NCM em uma lista de exceção.
}
\details{
A função:
\enumerate{
\item Lê o anexo I por meio de \code{\link[=ler_anexo_formatado]{ler_anexo_formatado()}} com \code{n_anexo = "i"},
removendo a coluna \code{resolucoes};
\item Lê o anexo II por meio de \code{\link[=ler_anexo_formatado]{ler_anexo_formatado()}} com \code{n_anexo = "ii"},
obtendo a Tarifa Externa Brasileira (\code{aliquota_aplicada_percent})
como coluna numérica \code{teb};
\item Processa os demais anexos de exceção por meio de
\code{\link[=detalhar_listas_excecao_vigentes]{detalhar_listas_excecao_vigentes()}}, obtendo, entre outros, a coluna
\code{tarifa_aplicada} para NCM incluídas integralmente em listas de exceção;
\item Calcula a coluna \code{tarifa_aplicada} e prioriza, nessa ordem, a tarifa das
listas de exceção, a TEB e, na ausência dessas, a alíquota TEC (\code{tec_percent});
\item Ajusta a coluna \code{teb} para assumir a \code{tec_percent} quando a TEB estiver
ausente.
}

Quando \code{detalhar = FALSE} (padrão), a função retorna apenas as colunas
necessárias para identificar o NCM, a descrição, a lista de exceção
(quando aplicável), a TEB e a tarifa aplicada.

Quando \code{detalhar = TRUE}, a função amplia o resultado com colunas adicionais
derivadas de \code{\link[=detalhar_listas_excecao_vigentes]{detalhar_listas_excecao_vigentes()}}, incluindo:
\itemize{
\item \code{contagem_quota}: número de ocorrências com quota;
\item \code{contagem_ex}: número de destaques (Ex);
\item \code{quota}: indicador (0/1) de existência de quota para a NCM;
\item \code{destaque_ex}: indicador (0/1) de existência de destaque (Ex);
\item \code{ncm_integral}: indicador (0/1) de medida aplicável à NCM integralmente.
}
}
\examples{
\dontrun{
# Resultado enxuto, apenas com tarifa aplicada e TEB:
x <- download_tarifas()
tarifas <- tarifas_aplicadas(x)
dplyr::glimpse(tarifas)

# Resultado detalhado, com informações de quota, Ex e NCM integral:
tarifas_detalhadas <- tarifas_aplicadas(x, detalhar = TRUE)
dplyr::glimpse(tarifas_detalhadas)
}

}
\seealso{
\code{\link[=ler_anexo_formatado]{ler_anexo_formatado()}}, \code{\link[=detalhar_listas_excecao_vigentes]{detalhar_listas_excecao_vigentes()}},
\code{\link[=tarifas_vigentes]{tarifas_vigentes()}}.
}
